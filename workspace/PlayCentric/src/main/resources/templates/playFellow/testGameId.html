<!DOCTYPE html>
<html lang="zh-TW" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PlayFellow Members</title>
    <style>
        .member-card {
            border: 1px solid #ccc;
            padding: 10px;
            margin: 10px;
            box-shadow: 0 4px 4px -2px rgba(0, 0, 0, 0.2);
        }
        .member-card img {
            max-width: 100px;
            height: auto;
            display: block;
            margin: 10px 0;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .member-card img.loaded {
            opacity: 1;
        }
    </style>
    <!-- 引入 Axios -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
    <h1>PlayFellow Members</h1>
    <input type="text" id="gameId" placeholder="Enter Game ID">
    <button onclick="fetchPlayFellowMembers()">Fetch Members</button>

    <div id="members"></div>

    <script>
        function fetchPlayFellowMembers() {
            // 獲取輸入框中的 Game ID
            const gameId = document.getElementById('gameId').value;

            // 使用 Axios 發送 GET 請求到後端 API
            axios.get(`/PlayCentric/playFellow/playFellowByGameId`, {
                params: {
                    gameId: gameId // 傳遞 Game ID 作為請求參數
                }
            })
            .then(response => {
                // 請求成功，處理返回的數據
                const members = response.data;

                // 獲取顯示成員列表的 div
                const membersDiv = document.getElementById('members');
                membersDiv.innerHTML = ''; // 清空之前的內容

                // 檢查返回的數據
                console.log(members);

                // 遍歷成員列表，並創建相應的 HTML 元素來顯示每個成員的信息
                members.forEach(member => {
                    const memberDiv = document.createElement('div');
                    memberDiv.classList.add('member-card');

                    // 使用 innerHTML 插入 HTML 標籤和數據
                    memberDiv.innerHTML = `
                        <h2>PlayFellow ID: ${member.playFellowId}</h2>
                        <p>Game: ${member.gameName}</p>
                        <p>Nickname: ${member.pfNickname}</p>
                        <p>金額: ${member.amount}</p>
                        <p>計價方式: ${member.pricingCategory}</p>
                        ${member.base64Image ? `<img data-src="data:image/jpeg;base64,${member.base64Image}" alt="Member Image" class="lazy-load"/>` : ''}
                    `;

                    // 將成員的卡片添加到 membersDiv 中
                    membersDiv.appendChild(memberDiv);
                });

                // 懶加載圖片
                lazyLoadImages();
            })
            .catch(error => {
                // 請求失敗，處理錯誤
                console.error('Error fetching members:', error);
            });
        }

        function lazyLoadImages() {
            const lazyImages = document.querySelectorAll('img.lazy-load');
            const config = {
                rootMargin: '0px 0px 50px 0px',
                threshold: 0.01
            };

            let observer = new IntersectionObserver(function(entries, self) {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        preloadImage(entry.target);
                        self.unobserve(entry.target);
                    }
                });
            }, config);

            lazyImages.forEach(image => {
                observer.observe(image);
            });
        }

        function preloadImage(img) {
            const src = img.getAttribute('data-src');
            if (!src) {
                return;
            }
            img.src = src;
            img.classList.remove('lazy-load');
            img.classList.add('loaded');
        }
    </script>
</body>
</html>
