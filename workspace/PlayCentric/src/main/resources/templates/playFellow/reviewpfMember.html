<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>伴遊資格審核</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
	<link href="https://cdn.datatables.net/1.10.21/css/dataTables.bootstrap4.min.css" rel="stylesheet">
	<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" rel="stylesheet">
	<style>
		body {
			background-color: #e9ecef !important;
			font-family: 'Roboto', sans-serif !important;
		}

		.row-wrapper {
			position: relative !important;
			display: flex !important;
			flex-direction: row !important;
			align-items: flex-start !important;
			border-radius: 8px !important;
			padding: 30px !important;
			margin-bottom: 10px !important;
			background-color: #f9f9f9 !important;
			color: #333 !important;
			border: 1px solid #ddd !important;
			box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1) !important;
			transition: opacity 0.5s ease, transform 0.5s ease, margin-bottom 0.5s ease, height 0.5s ease, padding 0.5s ease !important;
			width: 1000px !important;
		}

		.row-wrapper.hidden {
			opacity: 0 !important;
			transform: translateX(100%) !important;
			margin-bottom: 0 !important;
			height: 0 !important;
			padding: 0 !important;
			overflow: hidden !important;
		}

		.row-wrapper:hover {
			transform: scale(1.02) !important;
		}

		.field {
			margin-bottom: 10px !important;
			flex: 1 !important;
		}

		.field span {
			font-weight: bold !important;
			margin-right: 5px !important;
		}

		.action-link {
			color: #333 !important;
			text-decoration: none !important;
			margin-left: 10px !important;
		}

		.action-link:hover {
			color: #007bff !important;
		}

		.delete-icon {
			cursor: pointer !important;
		}

		.container {
			max-width: 1000px !important;
			margin: 0 auto !important;
		}

		.backBtn {
			position: fixed;
			bottom: 10px;
			right: 10px;
			background-color: transparent;
			color: #666;
			padding: 5px 10px;
			border-radius: 10px;
			transition: background-color 0.3s;
			z-index: 1000;
		}

		.backBtn:hover {
			font-weight: bold !important;
		}

		.status-pending {
			color: orange !important;
		}

		.status-failed {
			color: red !important;
		}

		.creation-time {
			position: absolute !important;
			top: 10px !important;
			left: 30px !important;
			color: gray !important;
			font-size: 0.8em !important;
		}

		.passStatusOrNot {
			margin: 10px !important;
			padding: 10px !important;
		}

		.text-center {
			text-align: center;
			color: rgb(255, 0, 0) !important;
		}
	</style>
</head>

<body>

	<button class="backBtn" id="backBtn">返回</button>
	<div th:replace="~{layout/nav.html}"></div>

	<main>


		<div class="container mt-5">
			<p class="h4 fw-bold m-3">伴遊資格審查</p>

			<div th:each="pfmember : ${PlayFellowMembers}" class="row-wrapper" id="row-wrapper">
				<div class="creation-time" th:text="${pfmember.pfcreatedTime}"></div>
				<div class="field">
					<span>編號:</span> <span th:text="${pfmember.playFellowId}"></span>
				</div>
				<div class="field">
					<span>伴遊暱稱:</span> <br> <span th:text="${pfmember.pfnickname}"></span>
				</div>
				<div class="field">
					<span>性別:</span> <br> <span th:text="${pfmember.member.gender == 1 ? '男生' : '女生'}"></span>
				</div>
				<div class="field">
					<span>生日:</span> <br> <span class="birthday" th:text="${pfmember.member.birthday}"></span>
				</div>
				<div class="field">
					<span>年齡:</span> <span class="age"></span>
				</div>
				<div class="field">
					<span>狀態:</span> <br> <span
						th:text="${pfmember.pfstatus == 1 ? '待審核' : (pfmember.pfstatus == 2 ? '審核成功' : (pfmember.pfstatus == 3 ? '開啟' : '關閉'))}"
						th:class="${pfmember.pfstatus == 1 ? 'status-pending' : pfmember.pfstatus == 2 ? 'status-failed' : pfmember.pfstatus == 3 ? 'status-open' : 'status-closed'}"></span>
				</div>
				<div class="field">
					<span>詳細:</span><br> <a class="action-link"
						th:href="@{/playFellow/updateMember/{playFellowId}(playFellowId=${pfmember.playFellowId})}">
						<i class="fas fa-file-invoice"></i>
					</a>
				</div>
				<div class="field">
					<span>審核:</span><br>
					<div class="passStatusOrNot d-flex justify-content-between">
						<i class="fas fa-check passIcon" style="color: rgb(0, 255, 157)"
							th:attr="data-playfellow-id=${pfmember.playFellowId} " data-pfstatus='3'></i>
						<i class="fas fa-solid fa-xmark failIcon" style="color: rgb(255, 0, 0)"
							th:attr="data-playfellow-id=${pfmember.playFellowId} " data-pfstatus='2'></i>
					</div>
				</div>
			</div>
			<table border="1">
				<tr th:if="${#lists.isEmpty(PlayFellowMembers)}">
					<td colspan="1" class="text-center">目前 無 待審核伴遊資料</td>
				</tr>
			</table>
		</div>

	</main>

	<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
	<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
	<!-- 	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script> -->

	<script>
		function calculateAge(birthday) {
			const birthDate = new Date(birthday);
			const today = new Date();
			let age = today.getFullYear() - birthDate.getFullYear();
			const monthDifference = today.getMonth() - birthDate.getMonth();

			if (monthDifference < 0 || (monthDifference === 0 && today.getDate() < birthDate.getDate())) {
				age--;
			}

			return age;
		}

		document.addEventListener('DOMContentLoaded', function () {
			const birthdayElements = document.querySelectorAll('.birthday');
			const ageElements = document.querySelectorAll('.age');

			birthdayElements.forEach((birthdayElement, index) => {
				const birthday = birthdayElement.textContent;
				const age = calculateAge(birthday);
				ageElements[index].textContent = age;
			});
		});

		document.addEventListener('DOMContentLoaded', function () {
			const backBtn = document.getElementById('backBtn');
			backBtn.addEventListener('click', function () {
				window.location.href = "http://localhost:8080/PlayCentric/playFellow/cms";
			});

			document.querySelectorAll('.passIcon, .failIcon').forEach(function (icon) {
				icon.addEventListener('click', function (event) {
					const playFellowId = event.target.getAttribute('data-playfellow-id');
					const pfstatus = event.target.getAttribute('data-pfstatus');

					console.log('playFellowId:', playFellowId);
					console.log('pfstatus:', pfstatus);

					const reviewMsg = new URLSearchParams();
					reviewMsg.append('playFellowId', playFellowId);
					reviewMsg.append('pfstatus', pfstatus);

					axios.post('/PlayCentric/playFellow/reviewPfstatus', reviewMsg, {
						headers: {
							'Content-Type': 'application/x-www-form-urlencoded'
						}
					}).then(res => {
						console.log(res.data);

						const rowElement = event.target.closest('.row-wrapper');
						if (rowElement) {
							rowElement.classList.add('hidden');
							setTimeout(() => {
								rowElement.style.display = 'none';
							}, 500);
						}

					}).catch(err => {
						console.error(err);
					});
				});
			});
		});

	</script>
</body>

</html>