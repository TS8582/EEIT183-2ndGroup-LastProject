<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>活動管理系統</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        .container {
            max-width: 800px;
            margin: auto;
            padding: 20px;
        }
        .event-form, .event-list {
            margin-bottom: 20px;
        }
        input, select, button {
            display: block;
            margin-bottom: 10px;
            width: 100%;
            padding: 8px;
            box-sizing: border-box;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        table, th, td {
            border: 1px solid #ddd;
        }
        th, td {
            padding: 8px;
            text-align: left;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>活動管理系統</h1>

        <div class="event-form">
            <h2>創建/更新活動</h2>
            <form id="eventForm">
                <input type="hidden" id="eventId">
                <label for="eventName">活動名稱</label>
                <input type="text" id="eventName" required>
                
                <label for="eventDescription">活動描述</label>
                <textarea id="eventDescription" required></textarea>
                
                <label for="eventType">活動類型</label>
                <select id="eventType">
                    <option value="1">圖片二次創作</option>
                    <option value="2">四格漫畫</option>
                </select>
                
                <label for="eventStartTime">開始時間</label>
                <input type="date" id="eventStartTime" required>
                
                <label for="eventEndTime">結束時間</label>
                <input type="date" id="eventEndTime" required>
                
                <label for="eventSignupDeadLine">報名截止時間</label>
                <input type="date" id="eventSignupDeadLine" required>
                
                <button type="submit">保存活動</button>
            </form>
        </div>

        <div class="event-list">
            <h2>活動列表</h2>
            <table id="eventTable">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>名稱</th>
                        <th>描述</th>
                        <th>類型</th>
                        <th>開始時間</th>
                        <th>結束時間</th>
                        <th>報名截止時間</th>
                        <th>操作</th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const eventForm = document.getElementById('eventForm');
            const eventTableBody = document.getElementById('eventTable').querySelector('tbody');

            // 讀取活動列表
            function loadEvents() {
                fetch('/PlayCentric/api/events/list')
                    .then(response => response.json())
                    .then(events => {
                        eventTableBody.innerHTML = '';
                        events.forEach(event => {
                            const row = document.createElement('tr');
                            row.innerHTML = `
                                <td>${event.eventId}</td>
                                <td>${event.eventName}</td>
                                <td>${event.eventDescription}</td>
                                <td>${event.eventType === 1 ? '圖片二次創作' : '四格漫畫'}</td>
                                <td>${new Date(event.eventStartTime).toLocaleString()}</td>
                                <td>${new Date(event.eventEndTime).toLocaleString()}</td>
                                <td>${new Date(event.eventSignupDeadLine).toLocaleString()}</td>
                                <td>
                                    <button onclick="editEvent(${event.eventId})">編輯</button>
                                    <button onclick="deleteEvent(${event.eventId})">刪除</button>
                                </td>
                            `;
                            eventTableBody.appendChild(row);
                        });
                    });
            }

            // 創建或更新活動
            eventForm.addEventListener('submit', function(event) {
                event.preventDefault();
                const formData = new FormData(eventForm);
                const eventId = formData.get('eventId');
                const data = {
                    eventName: formData.get('eventName'),
                    eventDescription: formData.get('eventDescription'),
                    eventType: formData.get('eventType'),
                    eventStartTime: new Date(formData.get('eventStartTime')).toISOString(),
                    eventEndTime: new Date(formData.get('eventEndTime')).toISOString(),
                    eventSignupDeadLine: new Date(formData.get('eventSignupDeadLine')).toISOString()
                };

                let url = '/PlayCentric/api/events/create';
                let method = 'POST';
                if (eventId) {
                    url = `/PlayCentric/api/events/update/${eventId}`;
                    method = 'PUT';
                }

                fetch(url, {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                })
                .then(response => response.json())
                .then(() => {
                    eventForm.reset();
                    loadEvents();
                });
            });

            // 編輯活動
            window.editEvent = function(eventId) {
                fetch(`/PlayCentric/api/events/get/${eventId}`)
                    .then(response => response.json())
                    .then(event => {
                        document.getElementById('eventId').value = event.eventId;
                        document.getElementById('eventName').value = event.eventName;
                        document.getElementById('eventDescription').value = event.eventDescription;
                        document.getElementById('eventType').value = event.eventType;
                        document.getElementById('eventStartTime').value = event.eventStartTime.split('T')[0];
                        document.getElementById('eventEndTime').value = event.eventEndTime.split('T')[0];
                        document.getElementById('eventSignupDeadLine').value = event.eventSignupDeadLine.split('T')[0];
                    });
            };

            // 刪除活動
            window.deleteEvent = function(eventId) {
                fetch(`/PlayCentric/api/events/delete/${eventId}`, {
                    method: 'DELETE'
                })
                .then(() => {
                    loadEvents();
                });
            };

            // 初始化讀取活動列表
            loadEvents();
        });
    </script>
</body>
</html>
