<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org/">

<head>
    <meta charset="UTF-8">
    <title>新增文章</title>
    <script th:src="@{/tinymce/js/tinymce/tinymce.min.js}"></script>
    <script th:src="@{/tinymce/langs/zh_TW.js}"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>

    <style>
        @keyframes fadeIn {
            0% {
                opacity: 0;
                transform: translateY(20px);
            }

            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }

        h1 {
            color: rgb(52, 0, 148) !important;
        }

        label {
            margin-bottom: 15px !important;
        }

        .d1 {
            animation: fadeIn 1s ease-in-out forwards;
            width: 75% !important;
            height: auto !important;
            margin-top: 20px !important;
            padding: 30px !important;
            background-color: #a256f88e;

        }

        #postForum div {
            display: flex;
            flex-direction: column;
        }

        table {
            display: flex;
            justify-content: start;
        }

        td label {
            margin-left: 240px;
        }

        .btn1 {
            background-color: yellow;
            border: 5px outset rgb(202, 199, 2);
            color: black;
            font-size: larger;
            width: 500px;
            transition: transform 0.2s;
        }

        .btn1:hover {
            background-color: rgb(255, 30, 30);
            border: 5px outset rgb(179, 10, 10);
            color: rgb(255, 255, 255);
            transform: translateY(4px);
        }

        .btn1:active {
            transform: translateY(2px);
            background-color: rgb(172, 16, 16);
            border: 5px inset rgb(116, 8, 8);
        }
    </style>
</head>

<body>
    <div th:replace="~{layout/nav}"></div>
    <!-- Navbar -->


    <div class="container rounded-2 d1 p-4">
        <div class="row">
            <h1 class="my-2 d-flex justify-content-center">新增文章</h1>
            <br>
            <form id="postForm" th:action="@{/texts/insertTextsData2}" method="post" enctype="multipart/form-data">
                <table>
                    <tr>
                        <td>
                            <div>
                                <label for="title">文章標題：</label>
                                <input type="text" id="title" name="title" required>
                            </div>
                        </td>
                        <br>
                        <td>
                            <div>
                                <label for="forumId">主題類型：</label>
                                <select id="forumId" name="forumId" required>
                                    <option value="" disabled selected>請選擇</option>
                                    <!-- Iterate over 'arrayList' to populate options -->
                                    <option th:each="forum : ${arrayList}" th:value="${forum.forumId}"
                                        th:text="${forum.forumName}">
                                    </option>
                                </select>
                            </div>
                        </td>
                    </tr>
                </table>
                <textarea id="textsContent" name="textsContent"></textarea>
                <br>
                <div class="d-flex justify-content-start">
                    <label for="files">選擇文章展示圖片：</label><br>
                    <input type="file" id="files" name="files" multiple>
                </div>
                <div class="d-flex justify-content-center">
                    <button class="btn1" type="submit">上傳</button>
                </div>
            </form>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.26.1/axios.min.js"
        integrity="sha512-bPh3uwgU5qEMipS/VOmRqynnMXGGSRv+72H/N260MQeXZIK4PG48401Bsby9Nq5P5fz7hy5UGNmC/W1Z51h2GQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <script>
        tinymce.init({
            selector: '#textsContent',
            height: 500,
            plugins: [
                'advlist', 'autolink', 'lists', 'image', 'charmap', 'preview',
                'searchreplace', 'visualblocks', 'fullscreen', 'code',
                'help', 'wordcount'
            ],
            toolbar: 'undo redo | blocks | ' +
                'bold italic backcolor | alignleft aligncenter ' +
                'alignright alignjustify | bullist numlist outdent indent | ' +
                'removeformat | help | image',
            content_style: 'body { font-family:Helvetica,Arial,sans-serif; font-size:16px }',
            language_url: '/static/langs/zh_TW.js',
            language: 'zh_TW',
            mobile: {
                menubar: true,
            },
            file_picker_types: 'image',
            images_upload_handler: function (blobInfo, progress) {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onload = function () {
                        const base64 = reader.result;
                        resolve(base64);
                    };
                    reader.onerror = function () {
                        reject('Could not read file');
                    };
                    reader.readAsDataURL(blobInfo.blob());
                });
            },
            setup: function (editor) {
                editor.on('submit', function (e) {
                    e.preventDefault();
                    editor.uploadImages().then(function () {
                        $('#postForm').submit();
                    });
                });
            }
        });

        $(document).ready(function () {
            $.ajax({
                url: '/findAllForumInTexts', // 修改为你实际的后端接口路径
                method: 'GET',
                success: function (data) {
                    data.forEach(function (theme) {
                        $('#forumId').append('<option value="' + forum.forumId + '">' + forum.forumName + '</option>');
                        console.log(data)
                    });
                },
                error: function (xhr, status, error) {
                    console.error('Error fetching themes:', error);
                    console.log(123)
                }
            });
        });
    </script>
</body>

</html>