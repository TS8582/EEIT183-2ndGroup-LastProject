<!DOCTYPE html>
<html>

<head>
  <title>PlayCentric-個人資訊</title>
  <style>
    input:focus,
    textarea:focus,
    select:focus {
      outline: none !important;
      box-shadow: none !important;
    }

    .cursor-pointer {
      cursor: pointer;
    }

    .h-0 {
      height: 0;
    }
  </style>
</head>

<body>
  <div th:replace="~{member/memInfoAside}"></div>

  <div class="p-0">
    <div class="container">
      <h1 class="text-center mt-3">個人資訊</h1>
      <form id="memInfo" class="row" action="#">
        <div class="col-10 pe-0">
          <div class="row">
            <label for="nickname" class="col-form-label col-1 px-0 text-end">暱稱:</label>
            <div class="col-2">
              <input type="text" readonly class="form-control-plaintext px-2" id="nickname" name="nickname" value="">
            </div>
            <label for="account" class="col-form-label col-1 px-0 text-end">帳號:</label>
            <div class="col-2">
              <input type="text" readonly class="form-control-plaintext px-2" id="account" name="account" value="">
            </div>
          </div>
          <div class="row">
            <div class="btn btn-outline-warning btn-sm col-4 align-self-center ms-4 mt-2 text-dark">修改密碼</div>
          </div>
          <div class="row mt-2">
            <label for="email" class="col-form-label col-1 px-0 text-end">Email:</label>
            <div class="col-5">
              <input type="text" readonly class="form-control-plaintext px-2" id="email" name="email" value="">
            </div>
          </div>
          <div class="d-flex my-4 justify-content-center align-items-center border border-secondary-subtle h-0 ms-2 me-5">
            <span class="px-3 text-secondary bg-light user-select-none">以上必填</span>
          </div>
          <div class="row">
            <label for="memName" class="col-form-label col-1 px-0 text-end">姓名:</label>
            <div class="col-2">
              <input type="text" readonly class="form-control-plaintext px-2" id="memName" name="memName" value="">
            </div>
            <label for="gender" class="col-form-label col-1 px-0 text-end">性別:</label>
            <div class="col-2">
              <select id="gender" name="gender" readonly class="form-control-plaintext"
                aria-label="Default select example">
                <option value="0" selected>選擇性別</option>
                <option value="1">男</option>
                <option value="2">女</option>
              </select>
            </div>
            <label for="birthday" class="col-form-label col-1 px-0 text-end">生日:</label>
            <div class="col-3">
              <input type="date" readonly class="form-control-plaintext px-2" id="birthday" name="birthday" value="">
            </div>
          </div>
          <div class="row mt-2">
            <label for="address" class="col-form-label col-2 px-0 text-center">聯絡地址:</label>
            <div class="col-8">
              <input type="text" readonly class="form-control-plaintext px-2" id="address" name="address" value="">
            </div>
          </div>

        </div>
        <div class="photo-div ps-0 col-2 cursor-pointer">
          <img class="w-100" src="http://localhost:8080/PlayCentric/imagesLib/image289">
          <input type="file" name="photoFile" id="photoFile" style="display: none;">
        </div>
        <div class="row">
          <div class="btn btn-warning">保存修改</div>
        </div>
      </form>
    </div>
  </div>

  <script>
    $(function () {
      const findMemUrl = "http://localhost:8080/PlayCentric/member/getMember"
      const memId = Number.parseInt('[[${session.loginMember.memId}]]');


      getMemInfo();


      $('.photo-div').on('click', 'img', function () {
        $('#photoFile').click();
      })

      $('#photoFile').change(function () {
        const file = this.files[0]
        if (file) {
          const reader = new FileReader();
          reader.onload = function (e) {
            // 設定圖片的 src 屬性為讀取的數據 URL
            $('.photo-div>img').attr('src', e.target.result);
          };
          // 讀取文件為數據 URL
          reader.readAsDataURL(file);
        }
      })

      $('[readonly]').mouseover(function () {
        $(this).addClass('border').addClass('rounded-2').mouseout(function () {
          $(this).removeClass('border').removeClass('rounded-2');
        });
      })

      $('[readonly]').click(onFocus)
      $('[readonly]').focus(onFocus)

      function onFocus() {
        $(this).removeAttr('readonly').removeClass('form-control-plaintext').addClass('form-control').blur(function () {
          $(this).addClass('form-control-plaintext').removeClass('form-control').attr('readonly', true)
        })
      }

      $(document).on('keydown', function (e) {
        if (e.key === "Escape") {  // 檢查是否按下了 Esc 鍵
          $('input:focus').blur();  // 使當前聚焦的輸入框失去焦點
        }
      });

      function getMemInfo() {
        axios({
          method: 'get',
          url: findMemUrl,
          params: { memId }
        })
          .then(res => {
            console.log(res);
            showMemInfo(res.data);
          })
          .catch(err => console.log(err))
      }

      function showMemInfo(data) {
        $('#memInfo #memId').val(data.memId);
        $('#memInfo #nickname').val(data.nickname);
        $('#memInfo #account').val(data.account);
        $('#memInfo #email').val(data.email);
        $('#memInfo #memName').val(data.memName ? data.memName : '');
        $('#memInfo #gender').val(data.gender ? data.gender : 0);
        $('#memInfo #birthday').val(data.birthday ? data.birthday : '');
        $('#memInfo #phone').val(data.phone ? data.phone : '');
        $('#memInfo #address').val(data.address ? data.address : '');
        $('#memInfo #role').prop('checked', data.role == 1 ? true : false);
      }
    })
  </script>
</body>

</html>